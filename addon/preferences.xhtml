<!-- 
  This is an XHTML fragment, not a full document. 
  It is loaded into the Zotero preferences pane.
-->

<!-- Restart Notice -->
<groupbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:html="http://www.w3.org/1999/xhtml">
    <html:p style="font-weight: bold; color: #d9534f;">
        Important: All settings on this page require a restart of Zotero to take full effect.
    </html:p>
</groupbox>

<!-- Global Hotkey Settings -->
<groupbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:html="http://www.w3.org/1999/xhtml">
    <caption label="Global Hotkey Settings" />
    
    <!-- Hotkey Modifier Keys -->
    <html:h4>Modifier Keys</html:h4>
    <html:p>Select at least one modifier key (Ctrl, Alt, Shift).</html:p>
    <hbox>
        <checkbox id="hotkey-ctrl" label="Ctrl" preference="extensions.zotero-in-tray.hotkey.ctrl"/>
        <checkbox id="hotkey-alt" label="Alt" preference="extensions.zotero-in-tray.hotkey.alt"/>
        <checkbox id="hotkey-shift" label="Shift" preference="extensions.zotero-in-tray.hotkey.shift"/>
    </hbox>
    
    <!-- Hotkey Character -->
    <html:h4>Main Key</html:h4>
    <html:p>Enter a single letter or number as the main key for the hotkey (e.g., 'K').</html:p>
    <html:input type="text" id="hotkey-key" preference="extensions.zotero-in-tray.hotkey.key" maxlength="1" style="width: 50px; text-transform: uppercase;"/>
</groupbox>

<!-- Startup Settings -->
<groupbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:html="http://www.w3.org/1999/xhtml">
    <caption label="Startup Settings" />
    
    <!-- Autohide on Startup -->
    <html:h4>Auto-hide on Startup</html:h4>
    <html:p>
        If enabled, Zotero will automatically hide its main window on startup, showing only the tray icon.
        <html:br/>
        This is mainly intended for "silent startup" when Zotero is launched on system login.
    </html:p>
    <checkbox id="startup-autohide" label="Auto-hide main window on startup" preference="extensions.zotero-in-tray.startup.autohide"/>
</groupbox>

<!-- Network Settings -->
<groupbox xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:html="http://www.w3.org/1999/xhtml">
    <caption label="Network Settings" />
    
    <!-- Communication Port -->
    <html:h4>Communication Port</html:h4>
    <html:p>
        The local port used for communication between the plugin and the tray helper process.
        <html:br/>
        It is not recommended to change this unless you encounter a port conflict. Restart Zotero after changing.
    </html:p>
    <html:input type="number" id="network-port" preference="extensions.zotero-in-tray.network.port" min="1024" max="65535" step="1" style="width: 100px;"/>

    <html:div id="recovery-info-box" style="margin-top: 15px; padding: 10px; border: 1px solid #c00; background-color: #fdd; border-radius: 4px; font-size: 9pt;">
        <html:h4 style="color: #c00; margin-top: 0; margin-bottom: 5px; font-weight: bold;">⚠️ Recovery Instructions</html:h4>
        <html:p style="margin-bottom: 5px;">
            Enabling <html:b>"Auto-hide"</html:b> with a conflicting port can make Zotero inaccessible. If this happens, follow these steps:
        </html:p>
        <html:ol style="margin: 0; padding-left: 20px;">
            <html:li>Completely quit Zotero and any `tray_helper.exe` processes.</html:li>
            <html:li>In your File Explorer, go to: <html:b>%APPDATA%\Zotero\Zotero\Profiles\</html:b> and open the `.default` folder.</html:li>
            <html:li>Open the `prefs.js` file with a text editor.</html:li>
            <html:li>Find and change one of the following lines:
                <html:ul style="margin-top: 5px; padding-left: 15px;">
                    <html:li>To disable auto-hide: change `startup.autohide", true` to `startup.autohide", false`.</html:li>
                    <html:li>To fix a port conflict: change `network.port", ...)` to a new number (e.g., `23121`).</html:li>
                </html:ul>
            </html:li>
        </html:ol>
        <html:p style="margin-top: 10px; margin-bottom: 0;">
            For full details, copy this link: <html:br/>
            <html:code>https://github.com/B3000Kcn/zotero-in-tray/blob/main/README.md#troubleshooting</html:code>
        </html:p>
    </html:div>
</groupbox> 
